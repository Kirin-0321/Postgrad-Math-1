# 假设检验

## 假设检验的基本概念

**假设检验**(hypothesis testing)是推断统计学的重要组成部分，用于判断样本数据是否支持某个关于总体参数的假设。

### 基本术语

- **统计假设**：关于总体分布的概率模型或总体参数的陈述。
- **原假设**(null hypothesis)：通常记为$H_0$，是我们想要检验的假设。原假设通常表示"没有效应"或"没有差异"。
- **备择假设**(alternative hypothesis)：通常记为$H_1$或$H_a$，与原假设相对立的假设。备择假设通常表示"存在效应"或"存在差异"。
- **显著性水平**(significance level)：通常记为$\alpha$，是我们愿意接受的犯第一类错误的概率，常用的值有0.05、0.01等。
- **检验统计量**(test statistic)：用于做出决策的随机变量，通常基于样本数据计算得到。
- **拒绝域**(rejection region)：检验统计量的取值范围，当检验统计量落入该范围时，拒绝原假设。
- **$p$值**($p$-value)：在原假设成立的条件下，获得当前样本或更极端样本的概率。如果$p$值小于显著性水平$\alpha$，则拒绝原假设。

### 假设检验的步骤

1. **提出假设**：明确原假设$H_0$和备择假设$H_1$。
2. **选择检验统计量**：根据假设和样本分布确定合适的检验统计量。
3. **确定显著性水平**：选择适当的显著性水平$\alpha$。
4. **确定拒绝域**：根据显著性水平和检验统计量的分布确定拒绝域。
5. **计算检验统计量**：利用样本数据计算检验统计量的值。
6. **做出决策**：如果检验统计量落入拒绝域，则拒绝原假设；否则，不拒绝原假设。
7. **解释结果**：根据统计决策给出实际问题的结论。

### 假设检验的类型

根据备择假设的形式，假设检验可分为：

1. **双侧检验**：当原假设$H_0: \theta = \theta_0$，备择假设$H_1: \theta \neq \theta_0$时。
2. **左侧检验**：当原假设$H_0: \theta \geq \theta_0$，备择假设$H_1: \theta < \theta_0$时。
3. **右侧检验**：当原假设$H_0: \theta \leq \theta_0$，备择假设$H_1: \theta > \theta_0$时。

## 两类错误与功效

在进行假设检验时，可能会犯两类错误：

### 第一类错误

**第一类错误**(Type I error)是指原假设$H_0$为真，但被错误地拒绝。第一类错误的概率通常用$\alpha$表示，即：

$$
\alpha = P(\text{拒绝}H_0 | H_0\text{为真})
$$

$\alpha$也称为**显著性水平**，是检验过程中预先设定的。

### 第二类错误

**第二类错误**(Type II error)是指原假设$H_0$为假，但未被拒绝。第二类错误的概率通常用$\beta$表示，即：

$$
\beta = P(\text{不拒绝}H_0 | H_0\text{为假})
$$

### 检验功效

**检验功效**(power of test)是在原假设为假时正确拒绝原假设的概率，即：

$$
\text{Power} = 1 - \beta = P(\text{拒绝}H_0 | H_0\text{为假})
$$

检验功效越高，表示检验越有效。

### 两类错误的权衡

降低第一类错误的概率（即降低$\alpha$）通常会导致第二类错误的概率（即$\beta$）增加，反之亦然。在实际应用中，需要根据具体问题合理权衡这两类错误。

提高检验功效的方法：

1. 增加样本容量
2. 增加显著性水平（但这会增加第一类错误的概率）
3. 采用单侧检验而非双侧检验（当合适时）
4. 使用更有效的检验统计量

## 正态总体参数的检验

### 单个正态总体均值的检验

设$X_1, X_2, \cdots, X_n$是来自正态总体$N(\mu, \sigma^2)$的样本，$\overline{X}$是样本均值，$S^2$是样本方差。

#### $\sigma^2$已知时均值$\mu$的检验

当总体方差$\sigma^2$已知时，检验$H_0: \mu = \mu_0$的统计量为：

$$
Z = \frac{\overline{X} - \mu_0}{\sigma/\sqrt{n}} \sim N(0, 1)
$$

对于不同的备择假设，拒绝域如下：

- $H_1: \mu \neq \mu_0$（双侧检验）：$|Z| > z_{\alpha/2}$
- $H_1: \mu > \mu_0$（右侧检验）：$Z > z_\alpha$
- $H_1: \mu < \mu_0$（左侧检验）：$Z < -z_\alpha$

其中$z_\alpha$是标准正态分布的上$\alpha$分位数。

#### $\sigma^2$未知时均值$\mu$的检验

当总体方差$\sigma^2$未知时，检验$H_0: \mu = \mu_0$的统计量为：

$$
T = \frac{\overline{X} - \mu_0}{S/\sqrt{n}} \sim t(n-1)
$$

对于不同的备择假设，拒绝域如下：

- $H_1: \mu \neq \mu_0$（双侧检验）：$|T| > t_{\alpha/2}(n-1)$
- $H_1: \mu > \mu_0$（右侧检验）：$T > t_\alpha(n-1)$
- $H_1: \mu < \mu_0$（左侧检验）：$T < -t_\alpha(n-1)$

其中$t_\alpha(n-1)$是自由度为$n-1$的$t$分布的上$\alpha$分位数。

### 单个正态总体方差的检验

设$X_1, X_2, \cdots, X_n$是来自正态总体$N(\mu, \sigma^2)$的样本，$S^2$是样本方差。

检验$H_0: \sigma^2 = \sigma_0^2$的统计量为：

$$
\chi^2 = \frac{(n-1)S^2}{\sigma_0^2} \sim \chi^2(n-1)
$$

对于不同的备择假设，拒绝域如下：

- $H_1: \sigma^2 \neq \sigma_0^2$（双侧检验）：$\chi^2 < \chi^2_{1-\alpha/2}(n-1)$ 或 $\chi^2 > \chi^2_{\alpha/2}(n-1)$
- $H_1: \sigma^2 > \sigma_0^2$（右侧检验）：$\chi^2 > \chi^2_\alpha(n-1)$
- $H_1: \sigma^2 < \sigma_0^2$（左侧检验）：$\chi^2 < \chi^2_{1-\alpha}(n-1)$

其中$\chi^2_\alpha(n-1)$是自由度为$n-1$的$\chi^2$分布的上$\alpha$分位数。

## 两个正态总体参数的检验

### 两个正态总体均值差的检验

设$X_1, X_2, \cdots, X_{n_1}$和$Y_1, Y_2, \cdots, Y_{n_2}$分别是来自正态总体$N(\mu_1, \sigma_1^2)$和$N(\mu_2, \sigma_2^2)$的两个独立样本，$\overline{X}$、$\overline{Y}$分别是两个样本的均值，$S_1^2$、$S_2^2$分别是两个样本的方差。

#### $\sigma_1^2$和$\sigma_2^2$已知时均值差$\mu_1 - \mu_2$的检验

当总体方差$\sigma_1^2$和$\sigma_2^2$已知时，检验$H_0: \mu_1 - \mu_2 = \delta_0$（通常$\delta_0 = 0$）的统计量为：

$$
Z = \frac{(\overline{X} - \overline{Y}) - \delta_0}{\sqrt{\frac{\sigma_1^2}{n_1} + \frac{\sigma_2^2}{n_2}}} \sim N(0, 1)
$$

对于不同的备择假设，拒绝域如下：

- $H_1: \mu_1 - \mu_2 \neq \delta_0$（双侧检验）：$|Z| > z_{\alpha/2}$
- $H_1: \mu_1 - \mu_2 > \delta_0$（右侧检验）：$Z > z_\alpha$
- $H_1: \mu_1 - \mu_2 < \delta_0$（左侧检验）：$Z < -z_\alpha$

#### $\sigma_1^2 = \sigma_2^2 = \sigma^2$但$\sigma^2$未知时均值差$\mu_1 - \mu_2$的检验

当总体方差相等但未知时，可以用合并样本方差$S_p^2 = \frac{(n_1-1)S_1^2 + (n_2-1)S_2^2}{n_1 + n_2 - 2}$作为$\sigma^2$的估计。检验$H_0: \mu_1 - \mu_2 = \delta_0$的统计量为：

$$
T = \frac{(\overline{X} - \overline{Y}) - \delta_0}{S_p\sqrt{\frac{1}{n_1} + \frac{1}{n_2}}} \sim t(n_1 + n_2 - 2)
$$

对于不同的备择假设，拒绝域如下：

- $H_1: \mu_1 - \mu_2 \neq \delta_0$（双侧检验）：$|T| > t_{\alpha/2}(n_1 + n_2 - 2)$
- $H_1: \mu_1 - \mu_2 > \delta_0$（右侧检验）：$T > t_\alpha(n_1 + n_2 - 2)$
- $H_1: \mu_1 - \mu_2 < \delta_0$（左侧检验）：$T < -t_\alpha(n_1 + n_2 - 2)$

#### $\sigma_1^2 \neq \sigma_2^2$且都未知时均值差$\mu_1 - \mu_2$的检验

当总体方差不等且都未知时，检验$H_0: \mu_1 - \mu_2 = \delta_0$的统计量为：

$$
T' = \frac{(\overline{X} - \overline{Y}) - \delta_0}{\sqrt{\frac{S_1^2}{n_1} + \frac{S_2^2}{n_2}}}
$$

$T'$近似服从自由度为$df$的$t$分布，其中$df$由下式给出：

$$
df = \frac{\left(\frac{S_1^2}{n_1} + \frac{S_2^2}{n_2}\right)^2}{\frac{1}{n_1-1}\left(\frac{S_1^2}{n_1}\right)^2 + \frac{1}{n_2-1}\left(\frac{S_2^2}{n_2}\right)^2}
$$

对于不同的备择假设，拒绝域如下：

- $H_1: \mu_1 - \mu_2 \neq \delta_0$（双侧检验）：$|T'| > t_{\alpha/2}(df)$
- $H_1: \mu_1 - \mu_2 > \delta_0$（右侧检验）：$T' > t_\alpha(df)$
- $H_1: \mu_1 - \mu_2 < \delta_0$（左侧检验）：$T' < -t_\alpha(df)$

### 两个正态总体方差比的检验

设$X_1, X_2, \cdots, X_{n_1}$和$Y_1, Y_2, \cdots, Y_{n_2}$分别是来自正态总体$N(\mu_1, \sigma_1^2)$和$N(\mu_2, \sigma_2^2)$的两个独立样本，$S_1^2$、$S_2^2$分别是两个样本的方差。

检验$H_0: \sigma_1^2 = \sigma_2^2$（或等价地，$H_0: \sigma_1^2/\sigma_2^2 = 1$）的统计量为：

$$
F = \frac{S_1^2}{S_2^2} \sim F(n_1-1, n_2-1)
$$

注意：为了使$F$统计量的值大于1，通常将较大的样本方差放在分子上。

对于不同的备择假设，拒绝域如下：

- $H_1: \sigma_1^2 \neq \sigma_2^2$（双侧检验）：$F < F_{1-\alpha/2}(n_1-1, n_2-1)$ 或 $F > F_{\alpha/2}(n_1-1, n_2-1)$
- $H_1: \sigma_1^2 > \sigma_2^2$（右侧检验）：$F > F_\alpha(n_1-1, n_2-1)$
- $H_1: \sigma_1^2 < \sigma_2^2$（左侧检验）：$F < F_{1-\alpha}(n_1-1, n_2-1)$

其中$F_\alpha(n_1-1, n_2-1)$是自由度为$(n_1-1, n_2-1)$的$F$分布的上$\alpha$分位数。

## 非参数检验

**非参数检验**(nonparametric test)是不依赖于总体分布形式的统计检验方法，适用于总体分布未知或不满足正态性假设的情况。

### 符号检验

**符号检验**(sign test)是一种简单的非参数检验方法，用于推断单个总体的中位数或配对样本的差值中位数。

#### 单个总体中位数的符号检验

设$X_1, X_2, \cdots, X_n$是来自未知分布总体的样本，检验假设$H_0: \text{中位数} = M_0$。

- 记$n_+$为样本中大于$M_0$的观测值个数，$n_-$为样本中小于$M_0$的观测值个数（忽略等于$M_0$的观测值）。
- 在$H_0$为真的条件下，$n_+$服从二项分布$B(n_+ + n_-, 0.5)$。

对于备择假设$H_1: \text{中位数} \neq M_0$（双侧检验），拒绝域为：

$$
n_+ \leq k_1 \text{ 或 } n_+ \geq k_2
$$

其中$k_1$和$k_2$使得$P(n_+ \leq k_1) \approx \alpha/2$和$P(n_+ \geq k_2) \approx \alpha/2$。

当样本量较大时（通常$n_+ + n_- \geq 25$），可以使用正态近似：

$$
Z = \frac{n_+ - 0.5(n_+ + n_-)}{\sqrt{0.25(n_+ + n_-)}} \sim N(0, 1)
$$

拒绝域为$|Z| > z_{\alpha/2}$。

### 秩和检验

**秩和检验**(rank sum test)是一种用于比较两个独立样本是否来自同一分布的非参数检验方法。

#### Wilcoxon秩和检验（Mann-Whitney U检验）

设$X_1, X_2, \cdots, X_{n_1}$和$Y_1, Y_2, \cdots, Y_{n_2}$是来自两个独立总体的样本。

步骤：

1. 将两个样本合并，并按大小排序。
2. 给每个观测值赋予秩（rank），相同值取平均秩。
3. 计算第一个样本的秩和$W$。
4. 在$H_0$：两总体分布相同的条件下，$W$的期望和方差为：
   $$
   E(W) = \frac{n_1(n_1 + n_2 + 1)}{2}, \quad Var(W) = \frac{n_1 n_2(n_1 + n_2 + 1)}{12}
   $$

当样本量较大时（通常$n_1, n_2 \geq 10$），可以使用正态近似：

$$
Z = \frac{W - E(W)}{\sqrt{Var(W)}} \sim N(0, 1)
$$

对于备择假设$H_1$：两总体分布不同（双侧检验），拒绝域为$|Z| > z_{\alpha/2}$。

### 配对样本的符号秩检验

**Wilcoxon符号秩检验**(Wilcoxon signed-rank test)用于检验配对样本的差值是否来自中位数为0的分布。

设$(X_1, Y_1), (X_2, Y_2), \cdots, (X_n, Y_n)$是$n$对观测值，计算差值$D_i = X_i - Y_i$。

步骤：

1. 计算$|D_i|$并按大小排序，忽略$D_i = 0$的观测值。
2. 给每个$|D_i|$赋予秩，相同值取平均秩。
3. 计算正差值（$D_i > 0$）的秩和$W_+$。
4. 在$H_0$：差值的分布关于0对称的条件下，$W_+$的期望和方差为：
   $$
   E(W_+) = \frac{n(n+1)}{4}, \quad Var(W_+) = \frac{n(n+1)(2n+1)}{24}
   $$

当样本量较大时（通常$n \geq 25$），可以使用正态近似：

$$
Z = \frac{W_+ - E(W_+)}{\sqrt{Var(W_+)}} \sim N(0, 1)
$$

对于备择假设$H_1$：差值的分布不对称（双侧检验），拒绝域为$|Z| > z_{\alpha/2}$。

### 游程检验

**游程检验**(run test)用于检验样本的随机性，即样本是否是随机排列的。

一个**游程**(run)指的是一列连续相同的元素。例如，在序列AAABBBAAABBA中，有5个游程：AAA,BBB,AAA,BB,A。

设样本被分为两类元素（如A和B），$n_1$是A的个数，$n_2$是B的个数，$R$是游程的总数。

在$H_0$：样本是随机排列的条件下，$R$的期望和方差为：

$$
E(R) = \frac{2n_1n_2}{n_1 + n_2} + 1, \quad Var(R) = \frac{2n_1n_2(2n_1n_2 - n_1 - n_2)}{(n_1 + n_2)^2(n_1 + n_2 - 1)}
$$

当$n_1$和$n_2$较大时（通常$n_1, n_2 \geq 10$），可以使用正态近似：

$$
Z = \frac{R - E(R)}{\sqrt{Var(R)}} \sim N(0, 1)
$$

对于备择假设$H_1$：样本不是随机排列的（双侧检验），拒绝域为$|Z| > z_{\alpha/2}$。

### 适合度检验

**适合度检验**(goodness-of-fit test)用于检验实际观测的频数分布是否与理论分布相符。

#### 卡方适合度检验

卡方适合度检验的步骤如下：

1. 将取值范围分为$k$个互不相交的区间。
2. 计算每个区间的观测频数$O_i$和期望频数$E_i$。
3. 计算卡方统计量：
   $$
   \chi^2 = \sum_{i=1}^{k} \frac{(O_i - E_i)^2}{E_i}
   $$
4. 在$H_0$为真的条件下，$\chi^2$近似服从自由度为$k-1-m$的$\chi^2$分布，其中$m$是由样本估计的参数个数。

拒绝域为$\chi^2 > \chi^2_\alpha(k-1-m)$。

使用卡方适合度检验的注意事项：

- 每个区间的期望频数最好不小于5。
- 如果有区间的期望频数小于5，应考虑合并相邻区间。

### 独立性检验

**独立性检验**(test of independence)用于检验两个分类变量是否相互独立。

#### 卡方独立性检验

设两个分类变量$X$和$Y$分别有$r$和$c$个水平，形成$r \times c$列联表。记$O_{ij}$为实际观测的频数，$E_{ij}$为期望频数（在独立性假设下）：

$$
E_{ij} = \frac{n_{i \cdot} \times n_{\cdot j}}{n}
$$

其中$n_{i \cdot}$是第$i$行的和，$n_{\cdot j}$是第$j$列的和，$n$是总样本量。

卡方统计量为：

$$
\chi^2 = \sum_{i=1}^{r} \sum_{j=1}^{c} \frac{(O_{ij} - E_{ij})^2}{E_{ij}}
$$

在$H_0$：两个分类变量相互独立的条件下，$\chi^2$近似服从自由度为$(r-1)(c-1)$的$\chi^2$分布。

拒绝域为$\chi^2 > \chi^2_\alpha((r-1)(c-1))$。

使用卡方独立性检验的注意事项：

- 最好每个格子的期望频数不小于5。
- 如果有格子的期望频数小于5，应考虑合并相邻行或列。

### Kolmogorov-Smirnov检验

**Kolmogorov-Smirnov检验**(K-S test)用于检验样本是否来自某个连续分布。

设$F(x)$是理论分布函数，$F_n(x)$是样本的经验分布函数：

$$
F_n(x) = \frac{1}{n} \sum_{i=1}^{n} I(X_i \leq x)
$$

K-S统计量为理论分布与经验分布之间的最大差距：

$$
D_n = \sup_x |F_n(x) - F(x)|
$$

在$H_0$：样本来自分布$F(x)$的条件下，$D_n$的分布与样本量$n$有关，但不依赖于$F(x)$的具体形式（对于连续分布）。

对于显著性水平$\alpha$，拒绝域为$D_n > D_{n,\alpha}$，其中$D_{n,\alpha}$是K-S分布的临界值。

对于大样本（通常$n > 35$），临界值可近似为：

$$
D_{n,\alpha} \approx \frac{1}{\sqrt{n}} \times \begin{cases}
1.22, & \alpha = 0.10 \\
1.36, & \alpha = 0.05 \\
1.63, & \alpha = 0.01
\end{cases}
$$

K-S检验的优点：

- 适用于任何连续分布。
- 对小样本也有较好的效果。
- 检验基于样本的经验分布，不需要任意分组。

K-S检验的缺点：

- 仅适用于单个连续分布的检验。
- 当分布参数需要从样本估计时，临界值需要调整。
